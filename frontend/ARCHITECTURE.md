# 项目架构说明

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        应用层 (Application Layer)              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  Views (页面)  │  Components (组件)  │  Stores (状态) │  │
│  └────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                      基础设施层 (Infrastructure Layer)         │
│  ┌────────────────────────────────────────────────────────┐  │
│  │  Router Guards │  HTTP Client  │  Utils  │  Config   │  │
│  └────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                         第三方库 (Libraries)                   │
│         Vue 3  │  Vue Router  │  Pinia  │  Element Plus     │
└─────────────────────────────────────────────────────────────┘
```

## 分层职责

### 1. 基础设施层（Infrastructure Layer）✅ 已完成

**职责**：提供稳定、可复用的基础能力

**包含模块**：
- **Router**：路由配置框架、路由守卫
- **HTTP Client**：Axios 封装、拦截器、请求/响应处理
- **Utils**：工具函数库（存储、时间、安全、验证、日志等）
- **Config**：环境配置、常量定义
- **Mock**：Mock 数据系统
- **Build**：Vite 构建配置、优化策略

**特点**：
- 不包含业务逻辑
- 高度可配置
- 文档完善
- 稳定可靠

---

### 2. 应用层（Application Layer）⏳ 待实现

**职责**：实现具体的业务功能

**包含模块**：
- **Views**：页面组件（登录、预约、候场、直播等）
- **Components**：业务组件（设备选择器、视频网格等）
- **Stores**：状态管理（用户、面试、预约等）
- **Types**：TypeScript 类型定义

**特点**：
- 包含业务逻辑
- 依赖基础设施层
- 可快速迭代

---

## 依赖关系

```
应用层 ───依赖───> 基础设施层 ───依赖───> 第三方库
   ↑                    ↑
   │                    │
   └──── 不允许 ─────────┘  （基础设施层不依赖应用层）
```

**原则**：
- ✅ 应用层可以使用基础设施层的任何功能
- ❌ 基础设施层不能依赖应用层
- ✅ 两层都可以使用第三方库

---

## 目录映射

### 基础设施层目录
```
src/
├── api/                # ✅ HTTP 接口封装
├── router/             # ✅ 路由框架（不含页面）
├── config/             # ✅ 配置管理
├── utils/              # ✅ 工具函数库
└── main.ts             # ✅ 入口文件

mock/                   # ✅ Mock 数据
vite.config.ts          # ✅ 构建配置
.eslintrc.cjs           # ✅ 代码规范
```

### 应用层目录
```
src/
├── views/              # ⏳ 页面组件
├── components/         # ⏳ 业务组件
├── stores/             # ⏳ 状态管理
├── types/              # ⏳ 类型定义
└── styles/             # ⏳ 全局样式
```

---

## 数据流

### 1. 用户操作流程
```
用户操作 → 页面组件 → Store (Pinia) → API 调用 → HTTP Client → 后端
    ↑          ↓           ↓             ↓            ↓
    └──────────┴───────────┴─────────────┴────────────┘
                      数据返回并更新状态
```

### 2. 路由守卫流程
```
路由跳转 → beforeEach (守卫) → 检查登录 → 检查权限 → 检查时间窗口 → 进入页面
              ↓                    ↓          ↓            ↓
              └────────────────────┴──────────┴────────────┘
                         任一检查失败则重定向
```

### 3. HTTP 请求流程
```
API 调用 → 请求拦截器 (添加 Token) → 发送请求 → 响应拦截器 (错误处理) → 返回数据
             ↓                          ↓              ↓
         日志记录                    网络请求        统一格式化
```

---

## 扩展性设计

### 1. 新增路由
```typescript
// 在 router/index.ts 添加路由配置
{
  path: '/new-page',
  component: () => import('@/views/NewPage.vue'),
  meta: {
    title: '新页面',
    requireAuth: true,
    roles: ['admin']
  }
}
```

### 2. 新增 API
```typescript
// 在 api/ 目录创建新文件
export function getNewData() {
  return Http.get('/api/new-data')
}
```

### 3. 新增工具函数
```typescript
// 在 utils/ 目录添加新函数
export function newUtilFunction() {
  // 实现
}
```

### 4. 新增环境变量
```bash
# 在 .env.development 添加
VITE_NEW_CONFIG=value
```

---

## 性能优化策略

### 1. 代码分割
- ✅ 路由懒加载
- ✅ 组件按需导入
- ✅ 第三方库分包（vue、element-plus、utils）

### 2. 资源优化
- ✅ 图片小于 4KB 内联为 base64
- ✅ CSS 代码分割
- ✅ 生产环境移除 console

### 3. 缓存策略
- ✅ 资源文件名带 hash
- ✅ 长缓存策略
- ✅ CDN 加速（可选）

### 4. 请求优化
- ✅ Axios 请求/响应拦截
- ✅ 依赖预构建
- ✅ Mock 开发模式

---

## 安全策略

### 1. 身份认证
- ✅ Token 存储（内存优先）
- ✅ 401 自动跳转登录
- ✅ Token 刷新机制（可选）

### 2. 权限控制
- ✅ 路由级别权限（roles）
- ✅ 页面级别权限
- ✅ 按钮级别权限（待应用层实现）

### 3. 数据安全
- ✅ XSS 防护（escapeHtml）
- ✅ 敏感信息脱敏
- ✅ HTTPS 传输（生产环境）

### 4. 防作弊
- ✅ 切屏检测（antiCheatGuard）
- ✅ 事件上报机制
- ✅ 客户端日志记录

---

## 开发工作流

### 基础设施团队
1. 维护基础设施代码
2. 提供工具函数和配置
3. 优化构建性能
4. 解决技术难题

### 应用层团队
1. 使用基础设施提供的能力
2. 实现业务功能
3. 开发页面组件
4. 管理应用状态

---

## 最佳实践

### 1. 职责分离
- 基础设施只提供能力，不涉及业务
- 应用层专注业务，复用基础能力

### 2. 接口抽象
- API 接口提前定义
- 使用 Mock 数据并行开发

### 3. 类型安全
- 完善的 TypeScript 类型定义
- 避免使用 `any`

### 4. 代码规范
- 统一的 ESLint/Prettier 配置
- Git 提交前自动检查

### 5. 文档先行
- 每个模块都有 README
- 关键函数有注释说明

---

## 常见问题

### Q: 如何添加新的路由守卫规则？
A: 在 `router/guards.ts` 的 `beforeEach` 中添加逻辑。

### Q: 如何修改 API 基础地址？
A: 修改 `.env.development` 或 `.env.production` 中的 `VITE_API_BASE_URL`。

### Q: 如何关闭 Mock？
A: 设置 `VITE_USE_MOCK=false`。

### Q: 如何添加全局状态？
A: 在 `stores/` 目录创建新的 Pinia Store。

### Q: 如何自定义构建配置？
A: 修改 `vite.config.ts`。

